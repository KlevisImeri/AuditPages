import{c as m,b as p,e,p as C,r as g,q as G,s as k,o as M,x as T,w as I,v as $,n as q,t as f,F as H,d as F,y as K,f as O,i as z,g as J,z as u,h as P}from"./index-C36fTbgJ.js";import{a as Z,b as S,d as Q,u as W}from"./api-CoOyLFJu.js";import{_ as D}from"./_plugin-vue_export-helper-DlAUqK2U.js";const X={},Y={xmlns:"http://www.w3.org/2000/svg",width:"2em",height:"2em",viewBox:"0 0 14 14"};function ee(x,a){return p(),m("svg",Y,a[0]||(a[0]=[e("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round",d:"M1 3.5h12m-10.5 0h9v9a1 1 0 0 1-1 1h-7a1 1 0 0 1-1-1v-9h0Zm2 0V3a2.5 2.5 0 0 1 5 0v.5m-4 2V11m3-5.5V11"},null,-1)]))}const te=D(X,[["render",ee]]),oe={},se={xmlns:"http://www.w3.org/2000/svg",width:"4em",height:"4em",viewBox:"0 0 24 24"};function ne(x,a){return p(),m("svg",se,a[0]||(a[0]=[e("path",{fill:"currentColor",d:"M18 20.289L21.288 17l-.688-.688l-2.1 2.1v-4.887h-1v4.887l-2.1-2.1l-.688.688zM14.5 23.5v-1h7v1zm-8.384-4q-.652 0-1.134-.482T4.5 17.884V4.116q0-.652.482-1.134T6.116 2.5H13L18.5 8v3.14h-1V8.5h-5v-5H6.116q-.231 0-.424.192t-.192.423v13.77q0 .23.192.423t.423.192h6v1zm-.616-1v-15z"},null,-1)]))}const le=D(oe,[["render",ne]]),de={},ae={xmlns:"http://www.w3.org/2000/svg",width:"4em",height:"4em",viewBox:"0 0 24 24"};function re(x,a){return p(),m("svg",ae,a[0]||(a[0]=[e("path",{fill:"currentColor",d:"M11 17h2v-4h4v-2h-4V7h-2v4H7v2h4zm1 5q-2.075 0-3.9-.788t-3.175-2.137T2.788 15.9T2 12t.788-3.9t2.137-3.175T8.1 2.788T12 2t3.9.788t3.175 2.137T21.213 8.1T22 12t-.788 3.9t-2.137 3.175t-3.175 2.138T12 22"},null,-1)]))}const ie=D(de,[["render",re]]),ue={class:"hidden print:block whitespace-pre-wrap break-all p-1"},_={__name:"Textarea",props:{modelValue:String,text:String,wfull:{type:Boolean,default:!0},width:{type:Number,default:20}},emits:["update:modelValue","update:text","update:edited"],setup(x,{emit:a}){const w=x,l=a,h=C({get(){return w.text||w.modelValue},set(c){l("update:modelValue",c),l("update:text",c),l("update:edited",!0)}}),i=g(null),r=()=>{i.value&&(i.value.style.height="auto",i.value.style.height=`${i.value.scrollHeight}px`)};return G(()=>h.value,()=>{k(r)},{immediate:!0}),M(()=>{k(()=>{r(),setTimeout(r,51),window.addEventListener("resize",r)})}),T(()=>{window.removeEventListener("resize",r)}),(c,v)=>(p(),m(H,null,[I(e("textarea",{ref_key:"textarea",ref:i,"onUpdate:modelValue":v[0]||(v[0]=b=>h.value=b),class:q(["print:hidden p-1",x.wfull?"w-full":`w-${x.width}`]),onInput:r,rows:"1"},null,34),[[$,h.value]]),e("div",ue,f(h.value||" "),1)],64))}},ce={class:"p-3 mb-20"},me={key:0,class:"bg-red-500 text-white p-4 rounded"},pe={key:1},he={id:"table",class:"report-header"},ve={class:"report-header"},fe={colspan:"9"},be={class:"flex items-center justify-between font-bold mb-3 p-3"},_e={class:"flex flex-col items-center"},xe={class:"text-md"},ge={class:"flex justify-center items-center"},we={class:"text-md"},Ve={key:0,class:"text-md ml-20"},Ie={class:"report-content"},Ne={class:"border text-center"},ke={class:"border text-center"},Te={class:"border text-center"},$e={class:"border"},De={class:"border print:hidden"},Ue=["onUpdate:modelValue","onInput"],ye={class:"border text-center"},Ee=["onUpdate:modelValue","onInput"],Be={class:"hidden print:block"},ze={class:"border text-center"},Se=["onUpdate:modelValue","onInput"],Ce={class:"hidden print:block"},Me={class:"border"},qe={class:"border"},He={class:"border"},Le={class:"text-center px-4 print:hidden"},Re={class:"border text-center"},je={class:"border"},Ae={class:"border"},Ge={class:"fixed bottom-0 left-0 ml-4 mb-4 flex space-x-4 z-50"},Fe=["disabled"],Pe=F({__name:"Book",setup(x){const a=K(),w=g(""),l=g([]),h=g(null),i=a.params.houseId,{year:r,month:c,day:v,type:b}=a.query,U=g(""),y=g(),V=g(!1),E={0:void 0,1:"Belüftung Räume",2:"Leitungsspülung von Trinkwasserleitungen"},B=n=>{if(!n)return"";const t=n.split("-");if(t.length!==3)return"";const[o,d,s]=t,j=s.padStart(2,"0"),A=d.padStart(2,"0");return`${j}.${A}.${o}`},L=C(()=>{const n=[];if(v){const t=Number(v);isNaN(t)||t>=1&&t<=31&&n.push(t.toString())}if(c){const t=Number(c);if(!isNaN(t)&&t>=1&&t<=12){const d=new Intl.DateTimeFormat("de-DE",{month:"long"}),s=new Date(2e3,t-1,1);n.push(d.format(s))}}if(r){const t=Number(r);isNaN(t)||n.push(t.toString())}return n.join(" ")});M(async()=>{try{if(i){const n=await Z(i);w.value=n.address}console.debug(i,r,c,v,b),l.value=await S(i,r,c,v,b),l.value.forEach(n=>n.edited=!1),console.debug("Entries: ",l.value)}catch(n){h.value=n,console.error(n)}}),T(async()=>{await N()});const N=async()=>{if(!V.value){V.value=!0;try{if(l.value.length===0)return;const n=l.value.filter(d=>d.deleted),t=[];n.forEach(d=>{d.id&&t.push(d.id)}),t.length>0&&await Q(t),l.value=l.value.filter(d=>!d.deleted);const o=l.value.filter(d=>d.edited);o.length>0&&await W(o),l.value=await S(i,r,c,v,b),l.value.forEach(d=>d.edited=!1)}catch(n){h.value=n,console.error(n)}finally{V.value=!1}}},R=async()=>{const n={houseId:Number(i),year:Number(r),month:Number(c),day:Number(v),houseNumber:"",roomNumber:"",repairDescription:"",type:Number(b),noticedDate:"",completedDate:"",emergencyStartTime:"",travelInfo:"",feedbackToOffice:"",edited:!0};console.log(n),l.value.push(n),await k();const t=document.getElementById("table");window.scrollTo({top:t.scrollHeight,left:0,behavior:"smooth"})};return T(()=>{N().catch(n=>{console.error("Error saving changes on unmount:",n)})}),(n,t)=>(p(),m("div",ce,[h.value?(p(),m("div",me,f(h.value),1)):(p(),m("div",pe,[e("table",he,[e("thead",ve,[e("tr",null,[e("th",fe,[e("div",be,[t[2]||(t[2]=e("p",{class:"text-lg font-bold mr-2"},"Kommunikationsbuch",-1)),e("div",_e,[e("p",xe,"Gebäudename: "+f(w.value),1),e("div",ge,[e("p",we,"Monat und Jahr: "+f(L.value),1),E[z(b)]?(p(),m("p",Ve,f(E[z(b)]),1)):O("",!0)])]),t[3]||(t[3]=e("p",{class:"text-md"},"K-V-I Gebäudemanagement",-1))])])]),t[4]||(t[4]=e("tr",{class:"bg-gray-100"},[e("th",{class:"border px-1"},"Pos."),e("th",{class:"border px-1"},"Haus-Nr."),e("th",{class:"border px-1"},"Raum-Nr."),e("th",{class:"border px-55"},"Reparatur (Beschreibungstext)"),e("th",{class:"border px-1 print:hidden"},"Typ"),e("th",{class:"border px-1"},"festgestellt am:"),e("th",{class:"border px-5"},"erledigt am:"),e("th",{class:"border px-1"},"Uhrzeit bei Noteinsatz:"),e("th",{class:"border px-4"},"Anfahrt"),e("th",{class:"border px-1"},"Rückinfo ans Amt")],-1))]),e("tbody",Ie,[(p(!0),m(H,null,J(l.value,(o,d)=>(p(),m("tr",{key:o.id,class:q({"bg-red-200":o.deleted,"bg-gray-200":o.edited})},[e("td",Ne,f(d+1),1),e("td",ke,[u(_,{modelValue:o.houseNumber,"onUpdate:modelValue":s=>o.houseNumber=s,wfull:!0,onInput:s=>o.edited=!0},null,8,["modelValue","onUpdate:modelValue","onInput"])]),e("td",Te,[u(_,{modelValue:o.roomNumber,"onUpdate:modelValue":s=>o.roomNumber=s,wfull:!0,onInput:s=>o.edited=!0},null,8,["modelValue","onUpdate:modelValue","onInput"])]),e("td",$e,[u(_,{modelValue:o.repairDescription,"onUpdate:modelValue":s=>o.repairDescription=s,onInput:s=>o.edited=!0},null,8,["modelValue","onUpdate:modelValue","onInput"])]),e("td",De,[I(e("select",{"onUpdate:modelValue":s=>o.type=s,onInput:s=>o.edited=!0},t[5]||(t[5]=[e("option",{value:0},"Kommunikationsbuch",-1),e("option",{value:1},"Belüftung Räume",-1),e("option",{value:2},"Leitungsspülung von Trinkwasserleitungen",-1)]),40,Ue),[[P,o.type,void 0,{number:!0}]])]),e("td",ye,[I(e("input",{"onUpdate:modelValue":s=>o.noticedDate=s,type:"date",class:"w-full p-1 print:hidden",onInput:s=>o.edited=!0},null,40,Ee),[[$,o.noticedDate]]),e("div",Be,f(B(o.noticedDate)),1)]),e("td",ze,[I(e("input",{"onUpdate:modelValue":s=>o.completedDate=s,type:"date",class:"w-full p-1 print:hidden",onInput:s=>o.edited=!0},null,40,Se),[[$,o.completedDate]]),e("div",Ce,f(B(o.completedDate)),1)]),e("td",Me,[u(_,{modelValue:o.emergencyStartTime,"onUpdate:modelValue":s=>o.emergencyStartTime=s,onInput:s=>o.edited=!0},null,8,["modelValue","onUpdate:modelValue","onInput"])]),e("td",qe,[u(_,{modelValue:o.travelInfo,"onUpdate:modelValue":s=>o.travelInfo=s,onInput:s=>o.edited=!0},null,8,["modelValue","onUpdate:modelValue","onInput"])]),e("td",He,[u(_,{modelValue:o.feedbackToOffice,"onUpdate:modelValue":s=>o.feedbackToOffice=s,onInput:s=>o.edited=!0},null,8,["modelValue","onUpdate:modelValue","onInput"])]),e("td",Le,[u(te,{class:"hover:text-red-500",onClick:s=>{o.deleted=!o.deleted}},null,8,["onClick"])])],2))),128)),e("tr",null,[e("td",Re,f(l.value.length+1),1),t[6]||(t[6]=e("td",{class:"border text-center"},null,-1)),t[7]||(t[7]=e("td",{class:"border text-center"},null,-1)),t[8]||(t[8]=e("td",{class:"border p-1"},"Bearbeitet:",-1)),t[9]||(t[9]=e("td",{class:"border print:hidden"},null,-1)),t[10]||(t[10]=e("td",{class:"border"},null,-1)),t[11]||(t[11]=e("td",{class:"border"},null,-1)),t[12]||(t[12]=e("td",{class:"border p-1"},"Anfahrt",-1)),e("td",je,[u(_,{modelValue:U.value,"onUpdate:modelValue":t[0]||(t[0]=o=>U.value=o)},null,8,["modelValue"])]),e("td",Ae,[u(_,{modelValue:y.value,"onUpdate:modelValue":t[1]||(t[1]=o=>y.value=o),class:"p1"},null,8,["modelValue"])])])])])])),e("div",Ge,[e("button",{class:"print:hidden text-blue-500 hover:text-red-500 transition-colors",onClick:R},[u(ie,{class:"inline-block"})]),e("button",{class:"print:hidden disabled:opacity-50 disabled:cursor-not-allowed transition-colors",onClick:N,disabled:V.value},[u(le,{class:"text-green-500 hover:text-red-500 inline-block"})],8,Fe)])]))}});export{Pe as default};
