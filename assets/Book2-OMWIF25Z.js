import{c,b as m,e,p as F,r as g,q as Z,s as A,o as P,x as M,w as B,v as R,n as q,t as u,F as H,d as Q,y as W,a as j,z as d,f as G,i as z,A as K,B as O,g as X,h as Y}from"./index-DxSvRIrJ.js";import{a as ee,b as te,d as oe,u as le}from"./api-CcpJKXYU.js";import{_ as E}from"./_plugin-vue_export-helper-DlAUqK2U.js";const se={},de={xmlns:"http://www.w3.org/2000/svg",width:"2em",height:"2em",viewBox:"0 0 14 14"};function ae(_,r){return m(),c("svg",de,r[0]||(r[0]=[e("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round",d:"M1 3.5h12m-10.5 0h9v9a1 1 0 0 1-1 1h-7a1 1 0 0 1-1-1v-9h0Zm2 0V3a2.5 2.5 0 0 1 5 0v.5m-4 2V11m3-5.5V11"},null,-1)]))}const ne=E(se,[["render",ae]]),ie={},re={xmlns:"http://www.w3.org/2000/svg",width:"4em",height:"4em",viewBox:"0 0 24 24"};function ue(_,r){return m(),c("svg",re,r[0]||(r[0]=[e("path",{fill:"currentColor",d:"M18 20.289L21.288 17l-.688-.688l-2.1 2.1v-4.887h-1v4.887l-2.1-2.1l-.688.688zM14.5 23.5v-1h7v1zm-8.384-4q-.652 0-1.134-.482T4.5 17.884V4.116q0-.652.482-1.134T6.116 2.5H13L18.5 8v3.14h-1V8.5h-5v-5H6.116q-.231 0-.424.192t-.192.423v13.77q0 .23.192.423t.423.192h6v1zm-.616-1v-15z"},null,-1)]))}const ce=E(ie,[["render",ue]]),me={},ve={xmlns:"http://www.w3.org/2000/svg",width:"4em",height:"4em",viewBox:"0 0 24 24"};function pe(_,r){return m(),c("svg",ve,r[0]||(r[0]=[e("path",{fill:"currentColor",d:"M11 17h2v-4h4v-2h-4V7h-2v4H7v2h4zm1 5q-2.075 0-3.9-.788t-3.175-2.137T2.788 15.9T2 12t.788-3.9t2.137-3.175T8.1 2.788T12 2t3.9.788t3.175 2.137T21.213 8.1T22 12t-.788 3.9t-2.137 3.175t-3.175 2.138T12 22"},null,-1)]))}const he=E(me,[["render",pe]]),fe={},be={xmlns:"http://www.w3.org/2000/svg",width:"4em",height:"4em",viewBox:"0 0 24 24"};function _e(_,r){return m(),c("svg",be,r[0]||(r[0]=[e("path",{fill:"currentColor",d:"m12 16l4-4l-1.4-1.4l-1.6 1.6V8h-2v4.2l-1.6-1.6L8 12zm0 6q-2.075 0-3.9-.788t-3.175-2.137T2.788 15.9T2 12t.788-3.9t2.137-3.175T8.1 2.788T12 2t3.9.788t3.175 2.137T21.213 8.1T22 12t-.788 3.9t-2.137 3.175t-3.175 2.138T12 22"},null,-1)]))}const we=E(fe,[["render",_e]]),xe={class:"hidden print:block whitespace-pre-wrap break-all p-1"},i={__name:"Textarea",props:{modelValue:String,wfull:{type:Boolean,default:!0},width:{type:Number,default:20}},emits:["update:modelValue","input"],setup(_,{emit:r}){const U=_,a=r,h=F({get(){return U.modelValue},set(f){a("update:modelValue",f),a("input",f)}}),v=g(null),p=()=>{v.value&&(v.value.style.height="auto",v.value.style.height=`${v.value.scrollHeight}px`)};return Z(()=>h.value,()=>{A(p)},{immediate:!0}),P(()=>{A(()=>{p(),setTimeout(p,51),window.addEventListener("resize",p)})}),M(()=>{window.removeEventListener("resize",p)}),(f,w)=>(m(),c(H,null,[B(e("textarea",{ref_key:"textarea",ref:v,"onUpdate:modelValue":w[0]||(w[0]=b=>h.value=b),class:q(["print:hidden p-1",_.wfull?"w-full":`w-${_.width}`]),rows:"1"},null,2),[[R,h.value]]),e("div",xe,u(h.value||" "),1)],64))}},Ve={id:"table",class:"p-3 mb-20 w-[1850px] print:hidden"},ge={key:0,class:"bg-red-500 text-white p-4 rounded"},ke={key:1,class:"w-full"},Ue={class:"report-header"},Ie={class:"flex items-center justify-between font-bold mb-3 p-3"},Te={class:"flex flex-col items-center"},De={class:"text-md"},Ne={class:"flex justify-center items-center"},$e={class:"text-md"},ze={key:0,class:"text-md ml-20"},Be={class:"row-div"},Ee={class:"row-div"},Se={class:"row-div"},Ce={class:"row-div"},Ae={class:"row-div"},Me=["onUpdate:modelValue","onInput"],Re={class:"row-div"},qe=["onUpdate:modelValue","onInput"],He={class:"hidden print:block"},Je={class:"row-div"},Le=["onUpdate:modelValue","onInput"],je={class:"hidden print:block"},Ge={class:"row-div"},Ke={class:"row-div"},Oe={class:"row-div"},Fe={class:"row-div"},Pe={class:"row-div"},ye={class:"entity-grid"},Ze={class:"row-div"},Qe={class:"row-div"},We={class:"row-div"},Xe={class:"fixed bottom-0 left-0 ml-4 mb-4 flex space-x-4 z-50"},Ye=["disabled"],et={class:"p-3 mb-20 hidden print:block"},tt={id:"table",class:"report-header"},ot={class:"report-header"},lt={colspan:"10"},st={class:"flex items-center justify-between font-bold mb-3 p-3"},dt={class:"flex flex-col items-center"},at={class:"text-md"},nt={class:"flex justify-center items-center"},it={class:"text-md"},rt={key:0,class:"text-md ml-20"},ut={class:"report-content"},ct={class:"border text-center"},mt={class:"border text-center"},vt={class:"border text-center"},pt={class:"border"},ht={class:"border text-center"},ft={class:"hidden print:block"},bt={class:"border text-center"},_t={class:"hidden print:block"},wt={class:"border"},xt={class:"border"},Vt={class:"border"},gt={class:"border"},kt={class:"border text-center"},Ut={class:"border"},It={class:"border"},$t=Q({__name:"Book2",setup(_){const r=W(),U=g(""),a=g([]),h=g(null),v=r.params.houseId,{year:p,month:f,day:w,type:b}=r.query,I=g(""),T=g(),D=g(!1);let S;const N={0:void 0,1:"Belüftung Räume",2:"Leitungsspülung von Trinkwasserleitungen"};P(async()=>{try{if(v){const s=await ee(v);U.value=s.address}console.debug(v,p,f,w,b),a.value=await te(v,p,f,w,b),a.value.forEach((s,o)=>{s.edited=!1,s.index=o}),console.debug("Entries: ",a.value)}catch(s){h.value=s,console.error(s)}}),M(async()=>{await C()});const C=async()=>{if(!D.value){D.value=!0;try{if(a.value.length===0)return;const s=a.value.filter(t=>t.deleted),o=[];s.forEach(t=>{t.id&&o.push(t.id)}),o.length>0&&await oe(o),a.value=a.value.filter(t=>!t.deleted);const x=a.value.filter(t=>t.edited);let k=[];x.length>0&&(k=await le(x));for(let t=0;t<x.length;t++)x[t].id=k[t].id;a.value.forEach((t,V)=>{t.edited=!1,t.index=V})}catch(s){h.value=s,console.error(s)}finally{D.value=!1}}},y=async()=>{const s={index:a.value.length,houseId:Number(v),year:Number(p),month:Number(f),day:Number(w),houseNumber:"",roomNumber:"",repairDescription:"",type:Number(b),noticedDate:"",completedDate:"",emergencyStartTime:"",travelInfo:"",feedbackToOffice:"",extraJob:"",edited:!0};a.value.push(s),await A(),J()};M(()=>{C().catch(s=>{console.error("Error saving changes on unmount:",s)})});const J=()=>{S||(S=document.getElementById("table")),window.scrollTo({top:S.scrollHeight,left:0,behavior:"smooth"})},$=s=>{if(!s)return"";const o=s.split("-");if(o.length!==3)return"";const[x,k,t]=o,V=t.padStart(2,"0"),n=k.padStart(2,"0");return`${V}.${n}.${x}`},L=F(()=>{const s=[];if(w&&s.push(w),f){const o=new Intl.DateTimeFormat("de-DE",{month:"long"});s.push(o.format(new Date(2e3,Number(f)-1,1)))}return p&&s.push(p),s.join(" ")});return(s,o)=>{const x=O("DynamicScrollerItem"),k=O("DynamicScroller");return m(),c(H,null,[e("div",Ve,[h.value?(m(),c("div",ge,u(h.value),1)):(m(),c("div",ke,[e("div",Ue,[e("div",Ie,[o[4]||(o[4]=e("p",{class:"text-lg font-bold mr-2"},"Kommunikationsbuch",-1)),e("div",Te,[e("p",De,"Gebäudename: "+u(U.value),1),e("div",Ne,[e("p",$e,"Monat und Jahr: "+u(L.value),1),N[z(b)]?(m(),c("p",ze,u(N[z(b)]),1)):G("",!0)])]),o[5]||(o[5]=e("p",{class:"text-md"},"K-V-I Gebäudemanagement",-1))])]),o[10]||(o[10]=j('<div class="entity-grid bg-gray-100 font-bold text-center top-0 z-10 border-t"><div class="row-div">Pos.</div><div class="row-div">Haus-Nr.</div><div class="row-div">Raum-Nr.</div><div class="row-div">Reparatur (Beschreibungstext)</div><div class="row-div">Typ</div><div class="row-div">festgestellt am:</div><div class="row-div">erledigt am:</div><div class="row-div">Uhrzeit bei Noteinsatz:</div><div class="row-div">Anfahrt</div><div class="row-div">Rückinfo ans Amt</div><div class="row-div">Extra Arbeit</div><div class="row-div"></div></div>',1)),d(k,{items:a.value,"min-item-size":200,"key-field":"index"},{default:K(({item:t,index:V,active:n})=>[d(x,{item:t,active:n,"size-dependencies":[t.roomNumber,t.houseNumber,t.extraJob],"data-index":V},{default:K(()=>[(m(),c("div",{key:t.index,class:q([{"bg-red-200":t.deleted,"bg-gray-200":t.edited},"entity-grid"])},[e("div",Be,u(t.index+1),1),e("div",Ee,[d(i,{class:"text-center w-full",modelValue:t.houseNumber,"onUpdate:modelValue":l=>t.houseNumber=l,wfull:!0,onInput:l=>t.edited=!0},null,8,["modelValue","onUpdate:modelValue","onInput"])]),e("div",Se,[d(i,{class:"w-full text-center",modelValue:t.roomNumber,"onUpdate:modelValue":l=>t.roomNumber=l,wfull:!0,onInput:l=>t.edited=!0},null,8,["modelValue","onUpdate:modelValue","onInput"])]),e("div",Ce,[d(i,{class:"w-full",modelValue:t.repairDescription,"onUpdate:modelValue":l=>t.repairDescription=l,onInput:l=>t.edited=!0},null,8,["modelValue","onUpdate:modelValue","onInput"])]),e("div",Ae,[B(e("select",{"onUpdate:modelValue":l=>t.type=l,onInput:l=>t.edited=!0,class:"w-full"},o[6]||(o[6]=[e("option",{value:0},"Kommunikationsbuch",-1),e("option",{value:1},"Belüftung Räume",-1),e("option",{value:2},"Leitungsspülung von Trinkwasserleitungen",-1)]),40,Me),[[Y,t.type,void 0,{number:!0}]])]),e("div",Re,[B(e("input",{"onUpdate:modelValue":l=>t.noticedDate=l,type:"date",class:"w-full p-1 print:hidden",onInput:l=>t.edited=!0},null,40,qe),[[R,t.noticedDate]]),e("div",He,u($(t.noticedDate)),1)]),e("div",Je,[B(e("input",{"onUpdate:modelValue":l=>t.completedDate=l,type:"date",class:"w-full p-1 print:hidden",onInput:l=>t.edited=!0},null,40,Le),[[R,t.completedDate]]),e("div",je,u($(t.completedDate)),1)]),e("div",Ge,[d(i,{class:"w-full",modelValue:t.emergencyStartTime,"onUpdate:modelValue":l=>t.emergencyStartTime=l,onInput:l=>t.edited=!0},null,8,["modelValue","onUpdate:modelValue","onInput"])]),e("div",Ke,[d(i,{class:"w-full",modelValue:t.travelInfo,"onUpdate:modelValue":l=>t.travelInfo=l,onInput:l=>t.edited=!0},null,8,["modelValue","onUpdate:modelValue","onInput"])]),e("div",Oe,[d(i,{class:"w-full",modelValue:t.feedbackToOffice,"onUpdate:modelValue":l=>t.feedbackToOffice=l,onInput:l=>t.edited=!0},null,8,["modelValue","onUpdate:modelValue","onInput"])]),e("div",Fe,[d(i,{class:"w-full",modelValue:t.extraJob,"onUpdate:modelValue":l=>t.extraJob=l,onInput:l=>t.edited=!0},null,8,["modelValue","onUpdate:modelValue","onInput"])]),e("div",Pe,[d(ne,{class:"hover:text-red-500",onClick:l=>{t.deleted=!t.deleted}},null,8,["onClick"])])],2))]),_:2},1032,["item","active","size-dependencies","data-index"])]),_:1},8,["items"]),e("div",ye,[e("div",Ze,u(a.value.length+1),1),o[7]||(o[7]=j('<div class="row-div"></div><div class="row-div"></div><div class="border-r border-b p-1">Bearbeitet:</div><div class="row-div"></div><div class="row-div"></div><div class="row-div"></div><div class="border-r border-b p-1">Anfahrt</div>',7)),e("div",Qe,[d(i,{modelValue:I.value,"onUpdate:modelValue":o[0]||(o[0]=t=>I.value=t)},null,8,["modelValue"])]),e("div",We,[d(i,{modelValue:T.value,"onUpdate:modelValue":o[1]||(o[1]=t=>T.value=t)},null,8,["modelValue"])]),o[8]||(o[8]=e("div",{class:"row-div"},null,-1)),o[9]||(o[9]=e("div",{class:"row-div"},null,-1))])])),e("div",Xe,[e("button",{class:"print:hidden text-blue-500 hover:text-red-500 transition-colors",onClick:y},[d(he,{class:"inline-block"})]),e("button",{class:"print:hidden disabled:opacity-50 disabled:cursor-not-allowed transition-colors",onClick:C,disabled:D.value},[d(ce,{class:"text-green-500 hover:text-red-500 inline-block"})],8,Ye),e("button",{class:"print:hidden disabled:opacity-50 disabled:cursor-not-allowed transition-colors",onClick:J},[d(we,{class:"text-purple-500 hover:text-red-500 inline-block"})])])]),e("div",et,[e("table",tt,[e("thead",ot,[e("tr",null,[e("th",lt,[e("div",st,[o[11]||(o[11]=e("p",{class:"text-lg font-bold mr-2"},"Kommunikationsbuch",-1)),e("div",dt,[e("p",at,"Gebäudename: "+u(U.value),1),e("div",nt,[e("p",it,"Monat und Jahr: "+u(L.value),1),N[z(b)]?(m(),c("p",rt,u(N[z(b)]),1)):G("",!0)])]),o[12]||(o[12]=e("p",{class:"text-md"},"K-V-I Gebäudemanagement",-1))])])]),o[13]||(o[13]=e("tr",{class:"bg-gray-100"},[e("th",{class:"border px-1"},"Pos."),e("th",{class:"border px-1"},"Haus-Nr."),e("th",{class:"border px-1"},"Raum-Nr."),e("th",{class:"border px-40"},"Reparatur (Beschreibungstext)"),e("th",{class:"border px-1 print:hidden"},"Typ"),e("th",{class:"border px-1"},"festgestellt am:"),e("th",{class:"border px-5"},"erledigt am:"),e("th",{class:"border px-8"},"Uhrzeit bei Noteinsatz:"),e("th",{class:"border px-1"},"Anfahrt"),e("th",{class:"border px-1"},"Rückinfo ans Amt"),e("th",{class:"border px-10"},"Extra Arbeit")],-1))]),e("tbody",ut,[(m(!0),c(H,null,X(a.value,(t,V)=>(m(),c("tr",{key:t.id,class:q({"bg-red-200":t.deleted,"bg-gray-200":t.edited})},[e("td",ct,u(V+1),1),e("td",mt,[d(i,{class:"w-full",modelValue:t.houseNumber,"onUpdate:modelValue":n=>t.houseNumber=n},null,8,["modelValue","onUpdate:modelValue"])]),e("td",vt,[d(i,{class:"w-full",modelValue:t.roomNumber,"onUpdate:modelValue":n=>t.roomNumber=n},null,8,["modelValue","onUpdate:modelValue"])]),e("td",pt,[d(i,{class:"w-full",modelValue:t.repairDescription,"onUpdate:modelValue":n=>t.repairDescription=n},null,8,["modelValue","onUpdate:modelValue"])]),e("td",ht,[e("div",ft,u($(t.noticedDate)),1)]),e("td",bt,[e("div",_t,u($(t.completedDate)),1)]),e("td",wt,[d(i,{modelValue:t.emergencyStartTime,"onUpdate:modelValue":n=>t.emergencyStartTime=n},null,8,["modelValue","onUpdate:modelValue"])]),e("td",xt,[d(i,{class:"w-full",modelValue:t.travelInfo,"onUpdate:modelValue":n=>t.travelInfo=n,onInput:n=>t.edited=!0},null,8,["modelValue","onUpdate:modelValue","onInput"])]),e("td",Vt,[d(i,{class:"w-full",modelValue:t.feedbackToOffice,"onUpdate:modelValue":n=>t.feedbackToOffice=n},null,8,["modelValue","onUpdate:modelValue"])]),e("td",gt,[d(i,{class:"w-full",modelValue:t.extraJob,"onUpdate:modelValue":n=>t.extraJob=n},null,8,["modelValue","onUpdate:modelValue"])])],2))),128)),e("tr",null,[e("td",kt,u(a.value.length+1),1),o[14]||(o[14]=e("td",{class:"border text-center"},null,-1)),o[15]||(o[15]=e("td",{class:"border text-center"},null,-1)),o[16]||(o[16]=e("td",{class:"border p-1"},"Bearbeitet:",-1)),o[17]||(o[17]=e("td",{class:"border print:hidden"},null,-1)),o[18]||(o[18]=e("td",{class:"border"},null,-1)),o[19]||(o[19]=e("td",{class:"border"},null,-1)),o[20]||(o[20]=e("td",{class:"border p-1"},"Anfahrt",-1)),e("td",Ut,[d(i,{modelValue:I.value,"onUpdate:modelValue":o[2]||(o[2]=t=>I.value=t)},null,8,["modelValue"])]),e("td",It,[d(i,{modelValue:T.value,"onUpdate:modelValue":o[3]||(o[3]=t=>T.value=t),class:"p1"},null,8,["modelValue"])]),o[21]||(o[21]=e("td",{class:"border"},null,-1))])])])])],64)}}});export{$t as default};
