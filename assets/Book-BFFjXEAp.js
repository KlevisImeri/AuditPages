import{c,b as m,e,p as M,r as V,q as G,s as k,o as S,x as T,w as I,v as $,n as q,t as f,F as H,d as J,y as F,f as K,i as z,g as O,z as r,h as P}from"./index-g-f3o_GA.js";import{a as Z,b as C,d as Q,u as W}from"./api-CoOyLFJu.js";import{_ as U}from"./_plugin-vue_export-helper-DlAUqK2U.js";const X={},Y={xmlns:"http://www.w3.org/2000/svg",width:"2em",height:"2em",viewBox:"0 0 14 14"};function ee(_,a){return m(),c("svg",Y,a[0]||(a[0]=[e("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round",d:"M1 3.5h12m-10.5 0h9v9a1 1 0 0 1-1 1h-7a1 1 0 0 1-1-1v-9h0Zm2 0V3a2.5 2.5 0 0 1 5 0v.5m-4 2V11m3-5.5V11"},null,-1)]))}const te=U(X,[["render",ee]]),oe={},se={xmlns:"http://www.w3.org/2000/svg",width:"4em",height:"4em",viewBox:"0 0 24 24"};function le(_,a){return m(),c("svg",se,a[0]||(a[0]=[e("path",{fill:"currentColor",d:"M18 20.289L21.288 17l-.688-.688l-2.1 2.1v-4.887h-1v4.887l-2.1-2.1l-.688.688zM14.5 23.5v-1h7v1zm-8.384-4q-.652 0-1.134-.482T4.5 17.884V4.116q0-.652.482-1.134T6.116 2.5H13L18.5 8v3.14h-1V8.5h-5v-5H6.116q-.231 0-.424.192t-.192.423v13.77q0 .23.192.423t.423.192h6v1zm-.616-1v-15z"},null,-1)]))}const ne=U(oe,[["render",le]]),de={},ae={xmlns:"http://www.w3.org/2000/svg",width:"4em",height:"4em",viewBox:"0 0 24 24"};function re(_,a){return m(),c("svg",ae,a[0]||(a[0]=[e("path",{fill:"currentColor",d:"M11 17h2v-4h4v-2h-4V7h-2v4H7v2h4zm1 5q-2.075 0-3.9-.788t-3.175-2.137T2.788 15.9T2 12t.788-3.9t2.137-3.175T8.1 2.788T12 2t3.9.788t3.175 2.137T21.213 8.1T22 12t-.788 3.9t-2.137 3.175t-3.175 2.138T12 22"},null,-1)]))}const ie=U(de,[["render",re]]),ue={class:"hidden print:block whitespace-pre-wrap break-all p-1"},v={__name:"Textarea",props:{modelValue:String,wfull:{type:Boolean,default:!0},width:{type:Number,default:20}},emits:["update:modelValue","input"],setup(_,{emit:a}){const g=_,d=a,p=M({get(){return g.modelValue},set(h){d("update:modelValue",h),d("input",h)}}),i=V(null),u=()=>{i.value&&(i.value.style.height="auto",i.value.style.height=`${i.value.scrollHeight}px`)};return G(()=>p.value,()=>{k(u)},{immediate:!0}),S(()=>{k(()=>{u(),setTimeout(u,51),window.addEventListener("resize",u)})}),T(()=>{window.removeEventListener("resize",u)}),(h,b)=>(m(),c(H,null,[I(e("textarea",{ref_key:"textarea",ref:i,"onUpdate:modelValue":b[0]||(b[0]=x=>p.value=x),class:q(["print:hidden p-1",_.wfull?"w-full":`w-${_.width}`]),rows:"1"},null,2),[[$,p.value]]),e("div",ue,f(p.value||" "),1)],64))}},ce={class:"p-3 mb-20"},me={key:0,class:"bg-red-500 text-white p-4 rounded"},pe={key:1},he={id:"table",class:"report-header"},ve={class:"report-header"},fe={colspan:"10"},be={class:"flex items-center justify-between font-bold mb-3 p-3"},_e={class:"flex flex-col items-center"},xe={class:"text-md"},Ve={class:"flex justify-center items-center"},ge={class:"text-md"},we={key:0,class:"text-md ml-20"},Ie={class:"report-content"},Ne={class:"border text-center"},ke={class:"border text-center"},Te={class:"border text-center"},$e={class:"border"},Ue={class:"border print:hidden"},De=["onUpdate:modelValue","onInput"],Ee={class:"border text-center"},Be=["onUpdate:modelValue","onInput"],ye={class:"hidden print:block"},ze={class:"border text-center"},Ce=["onUpdate:modelValue","onInput"],Me={class:"hidden print:block"},Se={class:"border"},qe={class:"border"},He={class:"border"},Le={class:"border"},Re={class:"text-center px-4 print:hidden"},Ae={class:"border text-center"},je={class:"border"},Ge={class:"border"},Je={class:"fixed bottom-0 left-0 ml-4 mb-4 flex space-x-4 z-50"},Fe=["disabled"],Ze=J({__name:"Book",setup(_){const a=F(),g=V(""),d=V([]),p=V(null),i=a.params.houseId,{year:u,month:h,day:b,type:x}=a.query,D=V(""),E=V(),w=V(!1),B={0:void 0,1:"Belüftung Räume",2:"Leitungsspülung von Trinkwasserleitungen"},y=l=>{if(!l)return"";const t=l.split("-");if(t.length!==3)return"";const[o,n,s]=t,A=s.padStart(2,"0"),j=n.padStart(2,"0");return`${A}.${j}.${o}`},L=M(()=>{const l=[];if(b){const t=Number(b);isNaN(t)||t>=1&&t<=31&&l.push(t.toString())}if(h){const t=Number(h);if(!isNaN(t)&&t>=1&&t<=12){const n=new Intl.DateTimeFormat("de-DE",{month:"long"}),s=new Date(2e3,t-1,1);l.push(n.format(s))}}if(u){const t=Number(u);isNaN(t)||l.push(t.toString())}return l.join(" ")});S(async()=>{try{if(i){const l=await Z(i);g.value=l.address}d.value=await C(i,u,h,b,x),d.value.forEach(l=>l.edited=!1)}catch(l){p.value=l,console.error(l)}}),T(async()=>{await N()});const N=async()=>{if(!w.value){w.value=!0;try{if(d.value.length===0)return;const l=d.value.filter(n=>n.deleted),t=[];l.forEach(n=>{n.id&&t.push(n.id)}),t.length>0&&await Q(t),d.value=d.value.filter(n=>!n.deleted);const o=d.value.filter(n=>n.edited);o.length>0&&await W(o),d.value=await C(i,u,h,b,x),d.value.forEach(n=>n.edited=!1)}catch(l){p.value=l,console.error(l)}finally{w.value=!1}}},R=async()=>{const l={houseId:Number(i),year:Number(u),month:Number(h),day:Number(b),houseNumber:"",roomNumber:"",repairDescription:"",type:Number(x),noticedDate:"",completedDate:"",emergencyStartTime:"",travelInfo:"",feedbackToOffice:"",extraJob:"",edited:!0};d.value.push(l),await k();const t=document.getElementById("table");window.scrollTo({top:t.scrollHeight,left:0,behavior:"smooth"})};return T(()=>{N().catch(l=>{console.error("Error saving changes on unmount:",l)})}),(l,t)=>(m(),c("div",ce,[p.value?(m(),c("div",me,f(p.value),1)):(m(),c("div",pe,[e("table",he,[e("thead",ve,[e("tr",null,[e("th",fe,[e("div",be,[t[2]||(t[2]=e("p",{class:"text-lg font-bold mr-2"},"Kommunikationsbuch",-1)),e("div",_e,[e("p",xe,"Gebäudename: "+f(g.value),1),e("div",Ve,[e("p",ge,"Monat und Jahr: "+f(L.value),1),B[z(x)]?(m(),c("p",we,f(B[z(x)]),1)):K("",!0)])]),t[3]||(t[3]=e("p",{class:"text-md"},"K-V-I Gebäudemanagement",-1))])])]),t[4]||(t[4]=e("tr",{class:"bg-gray-100"},[e("th",{class:"border px-1"},"Pos."),e("th",{class:"border px-1"},"Haus-Nr."),e("th",{class:"border px-1"},"Raum-Nr."),e("th",{class:"border px-55"},"Reparatur (Beschreibungstext)"),e("th",{class:"border px-1 print:hidden"},"Typ"),e("th",{class:"border px-1"},"festgestellt am:"),e("th",{class:"border px-5"},"erledigt am:"),e("th",{class:"border px-1"},"Uhrzeit bei Noteinsatz:"),e("th",{class:"border px-1"},"Anfahrt"),e("th",{class:"border px-1"},"Rückinfo ans Amt"),e("th",{class:"border px-10"},"Extra Arbeit")],-1))]),e("tbody",Ie,[(m(!0),c(H,null,O(d.value,(o,n)=>(m(),c("tr",{key:o.id,class:q({"bg-red-200":o.deleted,"bg-gray-200":o.edited})},[e("td",Ne,f(n+1),1),e("td",ke,[r(v,{modelValue:o.houseNumber,"onUpdate:modelValue":s=>o.houseNumber=s,wfull:!0,onInput:s=>o.edited=!0},null,8,["modelValue","onUpdate:modelValue","onInput"])]),e("td",Te,[r(v,{modelValue:o.roomNumber,"onUpdate:modelValue":s=>o.roomNumber=s,wfull:!0,onInput:s=>o.edited=!0},null,8,["modelValue","onUpdate:modelValue","onInput"])]),e("td",$e,[r(v,{modelValue:o.repairDescription,"onUpdate:modelValue":s=>o.repairDescription=s,onInput:s=>o.edited=!0},null,8,["modelValue","onUpdate:modelValue","onInput"])]),e("td",Ue,[I(e("select",{"onUpdate:modelValue":s=>o.type=s,onInput:s=>o.edited=!0},t[5]||(t[5]=[e("option",{value:0},"Kommunikationsbuch",-1),e("option",{value:1},"Belüftung Räume",-1),e("option",{value:2},"Leitungsspülung von Trinkwasserleitungen",-1)]),40,De),[[P,o.type,void 0,{number:!0}]])]),e("td",Ee,[I(e("input",{"onUpdate:modelValue":s=>o.noticedDate=s,type:"date",class:"w-full p-1 print:hidden",onInput:s=>o.edited=!0},null,40,Be),[[$,o.noticedDate]]),e("div",ye,f(y(o.noticedDate)),1)]),e("td",ze,[I(e("input",{"onUpdate:modelValue":s=>o.completedDate=s,type:"date",class:"w-full p-1 print:hidden",onInput:s=>o.edited=!0},null,40,Ce),[[$,o.completedDate]]),e("div",Me,f(y(o.completedDate)),1)]),e("td",Se,[r(v,{modelValue:o.emergencyStartTime,"onUpdate:modelValue":s=>o.emergencyStartTime=s,onInput:s=>o.edited=!0},null,8,["modelValue","onUpdate:modelValue","onInput"])]),e("td",qe,[r(v,{modelValue:o.travelInfo,"onUpdate:modelValue":s=>o.travelInfo=s,onInput:s=>o.edited=!0},null,8,["modelValue","onUpdate:modelValue","onInput"])]),e("td",He,[r(v,{modelValue:o.feedbackToOffice,"onUpdate:modelValue":s=>o.feedbackToOffice=s,onInput:s=>o.edited=!0},null,8,["modelValue","onUpdate:modelValue","onInput"])]),e("td",Le,[r(v,{modelValue:o.extraJob,"onUpdate:modelValue":s=>o.extraJob=s,onInput:s=>o.edited=!0},null,8,["modelValue","onUpdate:modelValue","onInput"])]),e("td",Re,[r(te,{class:"hover:text-red-500",onClick:s=>{o.deleted=!o.deleted}},null,8,["onClick"])])],2))),128)),e("tr",null,[e("td",Ae,f(d.value.length+1),1),t[6]||(t[6]=e("td",{class:"border text-center"},null,-1)),t[7]||(t[7]=e("td",{class:"border text-center"},null,-1)),t[8]||(t[8]=e("td",{class:"border p-1"},"Bearbeitet:",-1)),t[9]||(t[9]=e("td",{class:"border print:hidden"},null,-1)),t[10]||(t[10]=e("td",{class:"border"},null,-1)),t[11]||(t[11]=e("td",{class:"border"},null,-1)),t[12]||(t[12]=e("td",{class:"border p-1"},"Anfahrt",-1)),e("td",je,[r(v,{modelValue:D.value,"onUpdate:modelValue":t[0]||(t[0]=o=>D.value=o)},null,8,["modelValue"])]),e("td",Ge,[r(v,{modelValue:E.value,"onUpdate:modelValue":t[1]||(t[1]=o=>E.value=o),class:"p1"},null,8,["modelValue"])]),t[13]||(t[13]=e("td",{class:"border"},null,-1))])])])])),e("div",Je,[e("button",{class:"print:hidden text-blue-500 hover:text-red-500 transition-colors",onClick:R},[r(ie,{class:"inline-block"})]),e("button",{class:"print:hidden disabled:opacity-50 disabled:cursor-not-allowed transition-colors",onClick:N,disabled:w.value},[r(ne,{class:"text-green-500 hover:text-red-500 inline-block"})],8,Fe)])]))}});export{Ze as default};
